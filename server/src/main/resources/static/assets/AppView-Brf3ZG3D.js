import{e as B,b as H,Q as R,c as X,d as q,_ as j,f as Y}from"./use-quasar-CnSieQMZ.js";import{k as P,h as T,c as A,O as J,r as d,w as K,P as k,Q as y,R as l,U as f,a1 as S,f as e,W as _,X as I,o as Z,a2 as V,a0 as D,V as Q,F as ee}from"./index-DJCyNgt5.js";import{Q as w}from"./QTd-BJuc11U2.js";import{Q as C}from"./QTable-D1z_xgAe.js";import{Q as E}from"./QPage-C33x6L_Q.js";import{a as x}from"./index-B9ygI19o.js";import{Q as ae}from"./QTree-CJe6jpsp.js";const U=P({name:"QSpace",setup(){const a=T("div",{class:"q-space"});return()=>a}}),te=["top","middle","bottom"],$=P({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:a=>te.includes(a)}},setup(a,{slots:r}){const s=A(()=>a.align!==void 0?{verticalAlign:a.align}:null),p=A(()=>{const i=a.outline===!0&&a.color||a.textColor;return`q-badge flex inline items-center no-wrap q-badge--${a.multiLine===!0?"multi":"single"}-line`+(a.outline===!0?" q-badge--outline":a.color!==void 0?` bg-${a.color}`:"")+(i!==void 0?` text-${i}`:"")+(a.floating===!0?" q-badge--floating":"")+(a.rounded===!0?" q-badge--rounded":"")+(a.transparent===!0?" q-badge--transparent":"")});return()=>T("div",{class:p.value,style:s.value,role:"status","aria-label":a.label},J(r.default,a.label!==void 0?[a.label]:[]))}});function le(a){var r={};function s(t,n){n=n||[];var b=n.concat(`${t.projectName}(${t.snapshotName})`);if(r[t.projectId]||(r[t.projectId]=[]),r[t.projectId].push({projectName:t.projectName,projectId:t.projectId,snapshotId:t.snapshotId,snapshotName:t.snapshotName,usagePath:b.join(" -> ")}),t.projDeps&&t.projDeps.length)for(var N=0;N<t.projDeps.length;N++)s(t.projDeps[N],b)}for(var p=0;p<a.length;p++)s(a[p],[]);var i=[];for(var m in r){for(var v=r[m],g={},h=0;h<v.length;h++)g[v[h].snapshotId]=!0;Object.keys(g).length>1&&(i=i.concat(v))}return i}const oe={class:"row items-center"},ne={class:"text-weight-bold"},se={class:"q-mt-md"},re={__name:"SnapshotView",props:["about","info"],setup(a){const r=a,s=d(r.about),p=d(r.info),i=d(""),m=[{name:"projectName",field:"projectName",label:"Project",sortable:!0,align:"left"},{name:"snapshotName",field:"snapshotName",label:"Snapshot",sortable:!0,align:"left"},{name:"usagePath",field:"usagePath",label:"Parent",sortable:!0,align:"left"}],v=d([]),g=d([]);function h(){v.value=[{projectName:s.value.appName,snapshotName:s.value.snapshotName,snapshotId:"0",projDeps:p.value.projDeps}],g.value=le([{projectName:s.value.appName,snapshotName:s.value.snapshotName,snapshotId:"0",projDeps:p.value.projDeps}])}return K(()=>[r.info,r.about],([t,n])=>{p.value=t,s.value=n,h()},{deep:!0}),h(),(t,n)=>(y(),k(E,{style:{"background-color":"white"},class:"full-width q-pa-md"},{default:l(()=>[f("div",null," Process App : "+S(s.value.appName)+" ("+S(s.value.shortName)+") ",1),f("div",null,"Snapshot : "+S(s.value.snapshotName),1),n[4]||(n[4]=f("br",null,null,-1)),f("div",null,[n[2]||(n[2]=f("div",{class:"text-h6"},"Toolkits",-1)),e(ae,{nodes:v.value,"node-key":"snapshotId","label-key":"projectName","children-key":"projDeps"},{"default-header":l(b=>[f("div",oe,[e(I,{name:"construction"}),n[1]||(n[1]=_(" Â  ",-1)),f("div",ne,S(b.node.projectName)+" ("+S(b.node.snapshotName)+") ",1)])]),_:1},8,["nodes"])]),f("div",se,[n[3]||(n[3]=f("h6",null,"Toolkit version mismatch",-1)),e(C,{columns:m,rows:g.value,filter:i.value},{top:l(()=>[e(U),e(B,{borderless:"",dense:"",placeholder:"Search",debounce:"300",color:"primary",modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=b=>i.value=b)},{append:l(()=>[e(I,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])])]),_:1}))}},ue={class:"q-pb-md q-gutter-sm"},ie={class:"q-gutter-md"},de={key:0,class:"text-subtitle1"},ce={key:0},Ne={__name:"AppView",props:["title","url"],setup(a){const r=a,s=H(),p=d([]),i=d(null),m=d(null),v=d([]),g=d(""),h=d(""),t=d({}),n=d([]),b=d({}),N=d({}),L=[{align:"left",name:"name",label:"Name",field:"name",sortable:!0},{align:"left",name:"shortName",label:"Short",field:"shortName",sortable:!0},{align:"left",name:"ID",label:"ID",field:"ID",sortable:!0},{align:"left",name:"snapshotCount",label:"Snapshot Count",field:o=>o.installedSnapshots?o.installedSnapshots.length:0,sortable:!0},{align:"left",name:"branch",label:"Branch",field:"defaultVersion",sortable:!0},{align:"left",name:"actions",label:"Action"}],O=[{align:"left",name:"name",label:"Name",field:"name",sortable:!0},{align:"left",name:"ID",label:"ID",field:"ID",sortable:!0},{align:"left",name:"active",label:"Active",field:"active",sortable:!0},{align:"left",name:"branchName",label:"Branch",field:"branchName",sortable:!0},{align:"left",name:"actions",label:"Action"}],F=()=>{m.value.start(),x({method:"GET",url:"/api/accounts"}).then(o=>{p.value=o.data}).catch(o=>{s.notify("Error loading envs"),console.error(o)}).finally(()=>{m.value.stop()})};Z(()=>{F()});const G=()=>{m.value.start(),x({method:"POST",url:r.url,data:i.value}).then(o=>{o.data.data.processAppsList&&(v.value=o.data.data.processAppsList,console.log(v.value))}).catch(o=>{s.notify("Error getting apps"),console.error(o)}).finally(()=>{m.value.stop()})},M=o=>{o&&o.installedSnapshots&&(t.value=o,n.value=o.installedSnapshots,console.log(n.value))},W=o=>{console.log("showSSDetails"),b.value=o,console.log(o),m.value.start(),x({method:"POST",url:"/api/snapshot",data:{account:i.value,snapshotId:o.ID}}).then(u=>{N.value=u.data.data,console.log("currentSnapshotInfo",N.value)}).catch(u=>{s.notify("Error getting apps"),console.error(u)}).finally(()=>{m.value.stop()})};return(o,u)=>(y(),V(ee,null,[e(R,{ref_key:"bar",ref:m,position:"top",size:"10px","skip-hijack":""},null,512),e(E,{class:"q-pa-md q-gutter-md"},{default:l(()=>[f("div",ue,[e(X,null,{default:l(()=>[e(q,{label:"Home",to:"/"}),e(q,{label:r.title},null,8,["label"])]),_:1})]),e(j,{title:r.title},{default:l(()=>[f("div",ie,[e(Y,{filled:"",modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=c=>i.value=c),options:p.value,label:"Enviroment","option-label":"title"},null,8,["modelValue","options"]),e(Q,{color:"primary",unelevated:"",onClick:G},{default:l(()=>[...u[3]||(u[3]=[_("Get Apps",-1)])]),_:1})])]),_:1},8,["title"]),e(j,{title:"Applications"},{default:l(()=>[e(C,{flat:"",bordered:"",columns:L,rows:v.value,filter:g.value},{top:l(()=>[e(B,{borderless:"",dense:"",placeholder:"Search",debounce:"300",color:"primary",modelValue:g.value,"onUpdate:modelValue":u[1]||(u[1]=c=>g.value=c)},{append:l(()=>[e(I,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":l(c=>[e(w,{props:c},{default:l(()=>[e(Q,{icon:"search",flat:"",color:"primary",onClick:z=>M(c.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]),_:1}),e(j,{title:"Snapshots"},{default:l(()=>[e(C,{flat:"",bordered:"",columns:O,rows:n.value,filter:h.value},{top:l(()=>[t.value.name?(y(),V("div",de,[_(S(t.value.name)+"("+S(t.value.shortName)+") ",1),t.value.defaultVersion?(y(),V("span",ce,"("+S(t.value.defaultVersion)+")",1)):D("",!0)])):D("",!0),e(U),e(B,{borderless:"",dense:"",placeholder:"Search",debounce:"300",color:"primary",modelValue:h.value,"onUpdate:modelValue":u[2]||(u[2]=c=>h.value=c)},{append:l(()=>[e(I,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-active":l(c=>[e(w,{props:c},{default:l(()=>[c.row.active?(y(),k($,{key:0,color:"primary",outline:""},{default:l(()=>[...u[4]||(u[4]=[_(" Yes ",-1)])]),_:1})):(y(),k($,{key:1,color:"warning",outline:""},{default:l(()=>[...u[5]||(u[5]=[_(" No ",-1)])]),_:1}))]),_:2},1032,["props"])]),"body-cell-actions":l(c=>[e(w,{props:c},{default:l(()=>[e(Q,{icon:"search",flat:"",color:"primary",onClick:z=>W(c.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]),_:1}),N.value.projDefaults?(y(),k(j,{key:0,title:"Snapshot Information"},{default:l(()=>[e(re,{about:{snapshotName:b.value.name,appName:t.value.name,shortName:t.value.shortName},info:N.value},null,8,["about","info"])]),_:1})):D("",!0)]),_:1})],64))}};export{Ne as _};
